<!DOCTYPE html><html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Следопыты - Улучшенная версия</title><style>*{margin:0;padding:0;box-sizing:border-box;font-family:Arial,sans-serif}body{background-color:#0f0f1a;color:#fff;overflow:hidden;user-select:none}#gameContainer{position:relative;width:100vw;height:100vh}#gameCanvas{display:block;background-color:#0f0f0f}.screen{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;background-color:rgba(20,20,30,.95);z-index:10}.hidden{display:none!important}h1{font-size:4rem;margin-bottom:1rem;color:#ff0;text-shadow:0 0 10px rgba(255,255,0,.5);text-align:center}h2{font-size:2.5rem;margin-bottom:2rem;color:#ff0;text-align:center}.subtitle{font-size:1.2rem;margin-bottom:2rem;color:#ccc}.menu-button{background-color:#32cd32;color:#fff;border:none;padding:15px 30px;margin:10px;font-size:1.5rem;border-radius:8px;cursor:pointer;transition:all .3s;min-width:200px;text-align:center}.menu-button:hover{background-color:#28a428;transform:scale(1.05)}.secondary-button{background-color:#666}.secondary-button:hover{background-color:#555}.input-container{margin:20px 0;text-align:center}.input-label{display:block;font-size:1.2rem;margin-bottom:8px}.name-input{width:300px;padding:12px;font-size:1.2rem;border:2px solid #ccc;border-radius:5px;background-color:#334;color:#fff;text-align:center}.name-input:focus{outline:0;border-color:#32cd32}.controls-list{list-style-type:none;margin:20px 0;text-align:left}.controls-list li{margin:15px 0;font-size:1.2rem}.player1-color{color:#ff3232}.player2-color{color:#3232ff}.game-info{position:absolute;top:10px;left:10px;background-color:rgba(0,0,0,.7);padding:10px;border-radius:5px;font-size:1rem}.player2-info{left:auto;right:10px}.rules{position:absolute;bottom:10px;left:50%;transform:translateX(-50%);background-color:rgba(0,0,0,.7);padding:10px;border-radius:5px;font-size:1rem;text-align:center}.game-over{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;background-color:rgba(0,0,0,.8);z-index:20}.winner-text{font-size:3rem;margin-bottom:2rem;text-shadow:0 0 10px rgba(255,255,255,.5)}.draw-text{color:#ff0}.restart-text{font-size:1.2rem;margin-top:1rem;color:#ccc}</style></head><body><div id="gameContainer"><canvas id="gameCanvas"></canvas><div id="menuScreen" class="screen"><h1>СЛЕДОПЫТЫ</h1><p class="subtitle">GitHub: https://github.com/pepexqw/</p><button id="playButton" class="menu-button">ИГРАТЬ</button> <button id="controlsButton" class="menu-button secondary-button">Управление</button></div><div id="nameInputScreen" class="screen hidden"><h2>ВВЕДИТЕ ИМЕНА</h2><div class="input-container"><label class="input-label player1-color">Игрок 1 (Красный):</label> <input type="text" id="player1Name" class="name-input" maxlength="12" value="КРАСНЫЙ"></div><div class="input-container"><label class="input-label player2-color">Игрок 2 (Синий):</label> <input type="text" id="player2Name" class="name-input" maxlength="12" value="СИНИЙ"></div><button id="startGameButton" class="menu-button">НАЧАТЬ ИГРУ</button></div><div id="controlsScreen" class="screen hidden"><h2>УПРАВЛЕНИЕ</h2><ul class="controls-list"><li><span class="player1-color">Игрок 1 (Красный):</span> W, A, S, D - движение</li><li><span class="player2-color">Игрок 2 (Синий):</span> Стрелки ↑, ←, ↓, → - движение</li><li><span style="color:#32cd32">Цель игры:</span> Оставить след на поле, избегая следов противника</li><li><span style="color:#ff0">Правила:</span> Свои следы безопасны, чужие - смертельны</li><li><span style="color:#c832c8">Перезапуск:</span> R - перезапуск игры после окончания</li></ul><button id="backButton" class="menu-button">НАЗАД</button></div><div id="gameUI" class="hidden"><div class="game-info player1-color" id="player1Info"></div><div class="game-info player2-color player2-info" id="player2Info"></div><div class="rules" id="rulesText">Избегайте следов противника! Свои следы безопасны.</div></div><div id="gameOverScreen" class="game-over hidden"><div id="winnerText" class="winner-text"></div><button id="restartButton" class="menu-button">ПЕРЕЗАПУСК</button> <button id="menuButton" class="menu-button secondary-button">МЕНЮ</button><div class="restart-text">Или нажмите R для перезапуска</div></div></div><script>let CELL_SIZE=24,GRID_WIDTH=Math.floor(window.innerWidth/CELL_SIZE),GRID_HEIGHT=Math.floor(window.innerHeight/CELL_SIZE),COLORS={BLACK:"#000000",WHITE:"#ffffff",RED:"#ff3232",BLUE:"#3232ff",GREEN:"#32cd32",YELLOW:"#ffff00",PURPLE:"#c832c8",DARK_RED:"#b41e1e",DARK_BLUE:"#1e1eb4",GRAY:"#646464",LIGHT_GRAY:"#c8c8c8",BACKGROUND:"#0f0f0f",GRID_LINE:"#232323",GRID_LINE_BOLD:"#323232"},canvas=document.getElementById("gameCanvas"),ctx=canvas.getContext("2d"),menuScreen=document.getElementById("menuScreen"),nameInputScreen=document.getElementById("nameInputScreen"),controlsScreen=document.getElementById("controlsScreen"),gameUI=document.getElementById("gameUI"),gameOverScreen=document.getElementById("gameOverScreen"),player1Info=document.getElementById("player1Info"),player2Info=document.getElementById("player2Info"),rulesText=document.getElementById("rulesText"),winnerText=document.getElementById("winnerText"),playButton=document.getElementById("playButton"),controlsButton=document.getElementById("controlsButton"),startGameButton=document.getElementById("startGameButton"),backButton=document.getElementById("backButton"),restartButton=document.getElementById("restartButton"),menuButton=document.getElementById("menuButton"),player1NameInput=document.getElementById("player1Name"),player2NameInput=document.getElementById("player2Name"),grid=[],player1,player2,gameState="menu",gameOver=!1,winner=null,animationId=null,lastTime=0,currentTime=0;class Player{constructor(e,t,a,n,r,i){this.x=e,this.y=t,this.color=a,this.darkColor=n,this.controls=r,this.name=i,this.alive=!0,this.trail=[],this.animationFrame=0,this.walkCycle=0,this.bobOffset=0,this.direction=0,this.legPhase=0}move(e,t){0<e?this.direction=0:e<0?this.direction=2:0<t?this.direction=1:t<0&&(this.direction=3),0<=this.x+e&&this.x+e<GRID_WIDTH&&0<=this.y+t&&this.y+t<GRID_HEIGHT&&(null!==grid[this.x+e][this.y+t]&&grid[this.x+e][this.y+t]!==this.color?this.alive=!1:(grid[this.x][this.y]=this.color,this.trail.push({x:this.x,y:this.y}),this.x+=e,this.y+=t,this.animationFrame++,this.walkCycle=(this.walkCycle+1)%30,this.bobOffset=1.5*Math.sin(.2*this.walkCycle),this.legPhase=(this.legPhase+1)%8))}draw(){for(let e=0;e<this.trail.length;e++){var t,a=this.trail[e],n=150-2*(this.trail.length-e);n<20||(t=1.2*Math.sin(.004*currentTime+e),t=CELL_SIZE-6+t,ctx.save(),ctx.globalAlpha=n/255,n=this.lightenColor(this.color,20),ctx.fillStyle=n,ctx.fillRect(a.x*CELL_SIZE+(CELL_SIZE-t)/2,a.y*CELL_SIZE+(CELL_SIZE-t)/2,t,t),ctx.strokeStyle="rgba(255, 255, 255, 0.3)",ctx.lineWidth=1,ctx.strokeRect(a.x*CELL_SIZE+(CELL_SIZE-t)/2,a.y*CELL_SIZE+(CELL_SIZE-t)/2,t,t),ctx.restore())}this.alive&&this.drawCharacter()}drawCharacter(){var e,t=this.x*CELL_SIZE,a=this.y*CELL_SIZE+this.bobOffset,n=t+(CELL_SIZE-16)/2,r=a+6,i=(this.drawRoundedRect(n,r,16,14,2,this.color),ctx.fillStyle=this.darkColor,this.drawRoundedRect(2+n,r+2,12,3,1),t+(CELL_SIZE-10)/2),o=a+2,i=(this.drawRoundedRect(i,o,10,10,3,this.color),{0:[{x:7+i,y:o+3},{x:7+i,y:o+6}],1:[{x:3+i,y:o+7},{x:6+i,y:o+7}],2:[{x:1+i,y:o+3},{x:1+i,y:o+6}],3:[{x:3+i,y:o+1},{x:6+i,y:o+1}]});ctx.fillStyle=COLORS.WHITE;for(e of i[this.direction])ctx.fillRect(e.x,e.y,2,2);this.drawLegs(t,a,n,r,16,14),this.drawArms(t,a,n,r,16,14)}drawLegs(e,t,a,n,r,i){var o=1.5*Math.sin(+this.legPhase),s=a+4,l=n+i-o,a=(this.drawRoundedRect(s,l,3,6,1,this.darkColor),a+r-4-3),r=n+i+o;this.drawRoundedRect(a,r,3,6,1,this.darkColor);this.drawRoundedRect(s-1,6+l,5,2,1,this.darkColor),this.drawRoundedRect(a-1,r+6,5,2,1,this.darkColor)}drawArms(e,t,a,n,r,i){var o=2*Math.sin(+this.legPhase+Math.PI),s=a-3,l=n+5+o,a=(this.drawRoundedRect(s,l,3,7,1,this.darkColor),a+r),r=n+5-o;this.drawRoundedRect(a,r,3,7,1,this.darkColor);this.drawRoundedRect(s-1,l+7,3,3,1,this.darkColor),this.drawRoundedRect(a-1,7+r,3,3,1,this.darkColor)}drawRoundedRect(e,t,a,n,r,i=null){i&&(ctx.fillStyle=i),ctx.beginPath(),ctx.moveTo(e+r,t),ctx.lineTo(e+a-r,t),ctx.quadraticCurveTo(e+a,t,e+a,t+r),ctx.lineTo(e+a,t+n-r),ctx.quadraticCurveTo(e+a,t+n,e+a-r,t+n),ctx.lineTo(e+r,t+n),ctx.quadraticCurveTo(e,t+n,e,t+n-r),ctx.lineTo(e,t+r),ctx.quadraticCurveTo(e,t,e+r,t),ctx.closePath(),ctx.fill()}lightenColor(e,t){var e=parseInt(e.slice(1),16),t=Math.round(2.55*t),a=(e>>16)+t,n=(e>>8&255)+t,e=(255&e)+t;return"#"+(16777216+65536*(a<255?a<1?0:a:255)+256*(n<255?n<1?0:n:255)+(e<255?e<1?0:e:255)).toString(16).slice(1)}}function drawBackground(){ctx.fillStyle=COLORS.BACKGROUND,ctx.fillRect(0,0,canvas.width,canvas.height),ctx.strokeStyle=COLORS.GRID_LINE,ctx.lineWidth=1;for(let e=0;e<canvas.width;e+=CELL_SIZE)ctx.beginPath(),ctx.moveTo(e,0),ctx.lineTo(e,canvas.height),ctx.stroke();for(let e=0;e<canvas.height;e+=CELL_SIZE)ctx.beginPath(),ctx.moveTo(0,e),ctx.lineTo(canvas.width,e),ctx.stroke();ctx.strokeStyle=COLORS.GRID_LINE_BOLD,ctx.lineWidth=1;for(let e=0;e<canvas.width;e+=4*CELL_SIZE)ctx.beginPath(),ctx.moveTo(e,0),ctx.lineTo(e,canvas.height),ctx.stroke();for(let e=0;e<canvas.height;e+=4*CELL_SIZE)ctx.beginPath(),ctx.moveTo(0,e),ctx.lineTo(canvas.width,e),ctx.stroke()}function updateUI(){player1Info.textContent=player1.name+": W, A, S, D",player2Info.textContent=player2.name+": ↑, ←, ↓, →"}function gameLoop(e){currentTime=e,lastTime;lastTime=e,"game"!==gameState||gameOver||updateGame(),drawGame(),animationId=requestAnimationFrame(gameLoop)}function updateGame(){!player1.alive&&player2.alive?(gameOver=!0,winner=player2.name,showGameOver()):player1.alive&&!player2.alive?(gameOver=!0,winner=player1.name,showGameOver()):player1.alive||player2.alive||(gameOver=!0,winner="НИЧЬЯ",showGameOver())}function drawGame(){"game"===gameState&&(drawBackground(),player1.draw(),player2.draw())}function handleKeyDown(e){if("game"===gameState&&!gameOver)switch(e.key){case"w":case"W":player1.move(0,-1);break;case"s":case"S":player1.move(0,1);break;case"a":case"A":player1.move(-1,0);break;case"d":case"D":player1.move(1,0);break;case"ArrowUp":player2.move(0,-1);break;case"ArrowDown":player2.move(0,1);break;case"ArrowLeft":player2.move(-1,0);break;case"ArrowRight":player2.move(1,0)}!gameOver||"r"!==e.key&&"R"!==e.key&&"к"!==e.key&&"К"!==e.key||restartGame(),"Escape"===e.key&&"game"===gameState&&showMenu()}function showMenu(){gameState="menu",menuScreen.classList.remove("hidden"),nameInputScreen.classList.add("hidden"),controlsScreen.classList.add("hidden"),gameUI.classList.add("hidden"),gameOverScreen.classList.add("hidden"),animationId&&(cancelAnimationFrame(animationId),animationId=null)}function showNameInput(){gameState="nameInput",menuScreen.classList.add("hidden"),nameInputScreen.classList.remove("hidden")}function showControls(){gameState="controls",menuScreen.classList.add("hidden"),controlsScreen.classList.remove("hidden")}function startGame(){gameState="game",nameInputScreen.classList.add("hidden"),gameUI.classList.remove("hidden"),grid=Array(GRID_WIDTH).fill().map(()=>Array(GRID_HEIGHT).fill(null)),player1=new Player(5,5,COLORS.RED,COLORS.DARK_RED,["w","s","a","d"],player1NameInput.value||"КРАСНЫЙ"),player2=new Player(GRID_WIDTH-6,GRID_HEIGHT-6,COLORS.BLUE,COLORS.DARK_BLUE,["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],player2NameInput.value||"СИНИЙ"),gameOver=!1,winner=null,updateUI(),animationId=animationId||requestAnimationFrame(gameLoop)}function showGameOver(){gameOverScreen.classList.remove("hidden"),"НИЧЬЯ"===winner?(winnerText.textContent="НИЧЬЯ!",winnerText.className="winner-text draw-text"):(winnerText.textContent=`ПОБЕДИЛ ${winner}!`,winnerText.className="winner-text",winnerText.style.color=winner===player1.name?COLORS.RED:COLORS.BLUE)}function restartGame(){gameOverScreen.classList.add("hidden"),startGame()}function resizeCanvas(){canvas.width=window.innerWidth,canvas.height=window.innerHeight}function init(){resizeCanvas(),window.addEventListener("resize",resizeCanvas),window.addEventListener("keydown",handleKeyDown),playButton.addEventListener("click",showNameInput),controlsButton.addEventListener("click",showControls),startGameButton.addEventListener("click",startGame),backButton.addEventListener("click",showMenu),restartButton.addEventListener("click",restartGame),menuButton.addEventListener("click",showMenu),nameInputScreen.addEventListener("click",()=>{player1NameInput.focus()}),player1NameInput.addEventListener("keydown",e=>{"Enter"===e.key&&player2NameInput.focus()}),player2NameInput.addEventListener("keydown",e=>{"Enter"===e.key&&startGame()})}init()</script></body></html>