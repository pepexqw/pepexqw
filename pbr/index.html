<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PepeBirdjaRender (RBR) - Crypto & Stocks Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logo {
            font-size: 2.5em;
            font-weight: bold;
            background: linear-gradient(45deg, #00ff88, #00ccff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #8899a6;
            font-size: 1.1em;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 14px;
        }

        .search-box input::placeholder {
            color: #8899a6;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.08);
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            margin: 10px 0;
        }

        .stat-label {
            color: #8899a6;
            font-size: 0.9em;
        }

        .positive {
            color: #00ff88;
        }

        .negative {
            color: #ff4444;
        }

        .neutral {
            color: #ffaa00;
        }

        .crypto-grid, .stocks-grid, .futures-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .crypto-card, .stock-card, .futures-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .crypto-card:hover, .stock-card:hover, .futures-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .crypto-header, .stock-header, .futures-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .crypto-name, .stock-name, .futures-name {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .crypto-symbol, .stock-symbol, .futures-symbol {
            color: #8899a6;
            font-size: 0.9em;
        }

        .crypto-price, .stock-price, .futures-price {
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .crypto-change, .stock-change, .futures-change {
            font-size: 0.9em;
            padding: 4px 8px;
            border-radius: 6px;
            background: rgba(0, 255, 136, 0.1);
        }

        .crypto-change.negative, .stock-change.negative, .futures-change.negative {
            background: rgba(255, 68, 68, 0.1);
        }

        .crypto-details, .stock-details, .futures-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .detail-item {
            font-size: 0.85em;
        }

        .detail-label {
            color: #8899a6;
        }

        .detail-value {
            font-weight: bold;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #8899a6;
        }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-left: 3px solid #00ff88;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .refresh-btn {
            background: linear-gradient(45deg, #00ff88, #00ccff);
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .refresh-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.3);
        }

        .footer {
            text-align: center;
            margin-top: 40px;
            color: #8899a6;
            font-size: 0.9em;
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Таблица стилей */
        .table-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.5em;
            margin-bottom: 15px;
            color: #ffffff;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: "";
            display: block;
            width: 4px;
            height: 20px;
            background: linear-gradient(45deg, #00ff88, #00ccff);
            border-radius: 2px;
        }

        .crypto-table, .stocks-table, .futures-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .crypto-table th, .stocks-table th, .futures-table th {
            background: rgba(255, 255, 255, 0.08);
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #8899a6;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .crypto-table td, .stocks-table td, .futures-table td {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .crypto-table tr:last-child td, .stocks-table tr:last-child td, .futures-table tr:last-child td {
            border-bottom: none;
        }

        .crypto-table tr:hover, .stocks-table tr:hover, .futures-table tr:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        .table-crypto, .table-stock, .table-futures {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .table-crypto img, .table-stock img, .table-futures img {
            width: 24px;
            height: 24px;
            border-radius: 50%;
        }

        .table-crypto-name, .table-stock-name, .table-futures-name {
            font-weight: bold;
        }

        .table-crypto-symbol, .table-stock-symbol, .table-futures-symbol {
            color: #8899a6;
            font-size: 0.85em;
        }

        .table-price {
            font-weight: bold;
        }

        .table-change {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.85em;
            font-weight: bold;
        }

        .table-market-cap, .table-volume {
            color: #8899a6;
            font-size: 0.9em;
        }

        .view-toggle {
            display: flex;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 4px;
            margin-bottom: 15px;
            width: fit-content;
        }

        .view-toggle-btn {
            padding: 8px 16px;
            border-radius: 6px;
            background: transparent;
            border: none;
            color: #8899a6;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .view-toggle-btn.active {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
        }

        /* Market Pulse Bar */
        .market-pulse-section {
            margin-bottom: 30px;
        }

        .pulse-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .pulse-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .pulse-title {
            font-size: 1.2em;
            font-weight: bold;
        }

        .pulse-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
        }

        .pulse-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #00ff88;
            animation: pulse 2s infinite;
        }

        .pulse-indicator.bearish {
            background: #ff4444;
            animation: pulse-bearish 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 255, 136, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(0, 255, 136, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 255, 136, 0); }
        }

        @keyframes pulse-bearish {
            0% { box-shadow: 0 0 0 0 rgba(255, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 68, 68, 0); }
        }

        .pulse-bar-container {
            width: 100%;
            height: 40px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            overflow: hidden;
            position: relative;
        }

        .pulse-bar {
            height: 100%;
            width: 50%;
            background: linear-gradient(90deg, #ff4444, #00ff88);
            border-radius: 20px;
            transition: all 2s ease;
            position: relative;
        }

        .pulse-marker {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            height: 100%;
            width: 2px;
            background: rgba(255, 255, 255, 0.5);
        }

        .pulse-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.85em;
            color: #8899a6;
        }

        /* Tabs */
        .tabs {
            display: flex;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 5px;
            width: fit-content;
            flex-wrap: wrap;
        }

        .tab {
            padding: 10px 20px;
            border-radius: 8px;
            background: transparent;
            border: none;
            color: #8899a6;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .tab.active {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
        }

        /* Russian stocks highlight */
        .russian-stock {
            position: relative;
        }

        .russian-stock::after {
            content: "RU";
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(45deg, #0055ff, #ffffff, #ff0000);
            color: #000;
            font-size: 10px;
            font-weight: bold;
            padding: 2px 6px;
            border-radius: 4px;
        }

        /* Futures specific styles */
        .funding-rate {
            font-size: 0.8em;
            padding: 2px 6px;
            border-radius: 4px;
            background: rgba(255, 170, 0, 0.1);
            color: #ffaa00;
        }

        .funding-rate.positive {
            background: rgba(0, 255, 136, 0.1);
            color: #00ff88;
        }

        .funding-rate.negative {
            background: rgba(255, 68, 68, 0.1);
            color: #ff4444;
        }

        .liquidation-bar {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin-top: 5px;
            overflow: hidden;
        }

        .liquidation-long {
            height: 100%;
            background: #00ff88;
            float: left;
        }

        .liquidation-short {
            height: 100%;
            background: #ff4444;
            float: right;
        }

        .open-interest {
            font-size: 0.85em;
            color: #8899a6;
        }

        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .crypto-grid, .stocks-grid, .futures-grid {
                grid-template-columns: 1fr;
            }
            
            .stats {
                grid-template-columns: 1fr 1fr;
            }
            
            .crypto-table, .stocks-table, .futures-table {
                display: block;
                overflow-x: auto;
            }
            
            .view-toggle, .tabs {
                width: 100%;
                justify-content: center;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                padding: 8px 12px;
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">PepeBirdjaRender</div>
            <div class="subtitle">RBR - Real-time Crypto, Stocks & Futures Dashboard</div>
        </div>

        <div class="controls">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search cryptocurrencies, stocks and futures...">
            </div>
            <button class="refresh-btn" onclick="loadAllData()">
                🔄 Refresh Data
            </button>
        </div>

        <div class="tabs">
            <button class="tab active" id="cryptoTab" onclick="switchTab('crypto')">Cryptocurrencies</button>
            <button class="tab" id="stocksTab" onclick="switchTab('stocks')">Stocks</button>
            <button class="tab" id="russianStocksTab" onclick="switchTab('russian')">Russian Stocks</button>
            <button class="tab" id="futuresTab" onclick="switchTab('futures')">Perpetual Futures</button>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-label">Total Market Cap</div>
                <div class="stat-value" id="totalMarketCap">-</div>
                <div class="stat-change" id="marketCapChange">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">24h Volume</div>
                <div class="stat-value" id="totalVolume">-</div>
                <div class="stat-change" id="volumeChange">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">BTC Dominance</div>
                <div class="stat-value" id="btcDominance">-</div>
                <div class="stat-change">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Active Currencies</div>
                <div class="stat-value" id="activeCurrencies">-</div>
                <div class="stat-change">-</div>
            </div>
        </div>

        <!-- Market Pulse Bar -->
        <div class="market-pulse-section">
            <div class="pulse-container">
                <div class="pulse-header">
                    <div class="pulse-title">Market Pulse</div>
                    <div class="pulse-status">
                        <div class="pulse-indicator" id="pulseIndicator"></div>
                        <span id="pulseStatus">Neutral</span>
                    </div>
                </div>
                <div class="pulse-bar-container">
                    <div class="pulse-bar" id="pulseBar"></div>
                    <div class="pulse-marker"></div>
                </div>
                <div class="pulse-labels">
                    <span>Bearish</span>
                    <span>Bullish</span>
                </div>
            </div>
        </div>

        <div class="view-toggle">
            <button class="view-toggle-btn active" id="gridViewBtn" onclick="toggleView('grid')">Grid View</button>
            <button class="view-toggle-btn" id="tableViewBtn" onclick="toggleView('table')">Table View</button>
        </div>

        <!-- Crypto Section -->
        <div id="cryptoSection">
            <div id="cryptoContainer" class="crypto-grid">
                <div class="loading">
                    <div class="spinner"></div>
                    <div>Loading cryptocurrency data...</div>
                </div>
            </div>

            <div class="table-section" id="cryptoTableSection" style="display: none;">
                <div class="section-title">Cryptocurrency Market Overview</div>
                <table class="crypto-table" id="cryptoTable">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Name</th>
                            <th>Price</th>
                            <th>24h Change</th>
                            <th>Market Cap</th>
                            <th>24h Volume</th>
                        </tr>
                    </thead>
                    <tbody id="cryptoTableBody">
                        <!-- Crypto table data will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Stocks Section -->
        <div id="stocksSection" style="display: none;">
            <div id="stocksContainer" class="stocks-grid">
                <div class="loading">
                    <div class="spinner"></div>
                    <div>Loading stocks data...</div>
                </div>
            </div>

            <div class="table-section" id="stocksTableSection" style="display: none;">
                <div class="section-title">Stock Market Overview</div>
                <table class="stocks-table" id="stocksTable">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Name</th>
                            <th>Price</th>
                            <th>Change</th>
                            <th>Change %</th>
                            <th>Market Cap</th>
                        </tr>
                    </thead>
                    <tbody id="stocksTableBody">
                        <!-- Stocks table data will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Russian Stocks Section -->
        <div id="russianStocksSection" style="display: none;">
            <div id="russianStocksContainer" class="stocks-grid">
                <div class="loading">
                    <div class="spinner"></div>
                    <div>Loading Russian stocks data...</div>
                </div>
            </div>

            <div class="table-section" id="russianStocksTableSection" style="display: none;">
                <div class="section-title">Russian Stock Market Overview</div>
                <table class="stocks-table" id="russianStocksTable">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Name</th>
                            <th>Price (RUB)</th>
                            <th>Change</th>
                            <th>Change %</th>
                            <th>Market Cap</th>
                        </tr>
                    </thead>
                    <tbody id="russianStocksTableBody">
                        <!-- Russian stocks table data will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Futures Section -->
        <div id="futuresSection" style="display: none;">
            <div id="futuresContainer" class="futures-grid">
                <div class="loading">
                    <div class="spinner"></div>
                    <div>Loading perpetual futures data...</div>
                </div>
            </div>

            <div class="table-section" id="futuresTableSection" style="display: none;">
                <div class="section-title">Perpetual Futures Overview</div>
                <table class="futures-table" id="futuresTable">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Pair</th>
                            <th>Price</th>
                            <th>24h Change</th>
                            <th>Funding Rate</th>
                            <th>Open Interest</th>
                            <th>Liquidation</th>
                        </tr>
                    </thead>
                    <tbody id="futuresTableBody">
                        <!-- Futures table data will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>

        <div class="footer">
            <div>Powered by CoinGecko API & Alpha Vantage | PepeBirdjaRender (RBR) v3.0</div>
            <div style="margin-top: 5px;">Data updates every 60 seconds</div>
        </div>
    </div>

    <script>
        // Popular cryptocurrencies to display
        const cryptoIds = [
            'bitcoin', 'ethereum', 'binancecoin', 'ripple', 'cardano',
            'solana', 'dogecoin', 'polkadot', 'matic-network', 'litecoin',
            'chainlink', 'stellar', 'avalanche-2', 'cosmos', 'monero'
        ];

        // Popular stocks to display
        const stockSymbols = [
            'AAPL', 'MSFT', 'GOOGL', 'AMZN', 'TSLA',
            'META', 'NVDA', 'JPM', 'JNJ', 'V',
            'PG', 'UNH', 'HD', 'DIS', 'PYPL'
        ];

        // Russian stocks to display
        const russianStockSymbols = [
            'GAZP', 'SBER', 'LKOH', 'ROSN', 'NVTK',
            'GMKN', 'PLZL', 'TATN', 'ALRS', 'POLY',
            'MGNT', 'AFKS', 'VTBR', 'MTSS', 'MOEX'
        ];

        // Futures pairs to display
        const futuresPairs = [
            'BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'XRP/USDT', 'ADA/USDT',
            'SOL/USDT', 'DOT/USDT', 'DOGE/USDT', 'MATIC/USDT', 'LTC/USDT',
            'LINK/USDT', 'AVAX/USDT', 'ATOM/USDT', 'XLM/USDT', 'XMR/USDT'
        ];

        // Current view state
        let currentView = 'grid';
        let currentTab = 'crypto';

        // Format currency
        function formatCurrency(value, currency = 'USD') {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: currency,
                minimumFractionDigits: value < 1 ? 4 : 2,
                maximumFractionDigits: value < 1 ? 4 : 2
            }).format(value);
        }

        // Format percentage
        function formatPercentage(value) {
            return value.toFixed(2) + '%';
        }

        // Format funding rate
        function formatFundingRate(value) {
            return (value * 100).toFixed(4) + '%';
        }

        // Format large numbers
        function formatNumber(value) {
            if (value >= 1e12) {
                return (value / 1e12).toFixed(2) + 'T';
            } else if (value >= 1e9) {
                return (value / 1e9).toFixed(2) + 'B';
            } else if (value >= 1e6) {
                return (value / 1e6).toFixed(2) + 'M';
            } else {
                return value.toLocaleString();
            }
        }

        // Switch between crypto, stocks, russian stocks and futures tabs
        function switchTab(tab) {
            currentTab = tab;
            
            const cryptoTab = document.getElementById('cryptoTab');
            const stocksTab = document.getElementById('stocksTab');
            const russianStocksTab = document.getElementById('russianStocksTab');
            const futuresTab = document.getElementById('futuresTab');
            const cryptoSection = document.getElementById('cryptoSection');
            const stocksSection = document.getElementById('stocksSection');
            const russianStocksSection = document.getElementById('russianStocksSection');
            const futuresSection = document.getElementById('futuresSection');
            
            // Reset all tabs
            cryptoTab.classList.remove('active');
            stocksTab.classList.remove('active');
            russianStocksTab.classList.remove('active');
            futuresTab.classList.remove('active');
            cryptoSection.style.display = 'none';
            stocksSection.style.display = 'none';
            russianStocksSection.style.display = 'none';
            futuresSection.style.display = 'none';
            
            // Activate selected tab
            if (tab === 'crypto') {
                cryptoTab.classList.add('active');
                cryptoSection.style.display = 'block';
            } else if (tab === 'stocks') {
                stocksTab.classList.add('active');
                stocksSection.style.display = 'block';
            } else if (tab === 'russian') {
                russianStocksTab.classList.add('active');
                russianStocksSection.style.display = 'block';
            } else if (tab === 'futures') {
                futuresTab.classList.add('active');
                futuresSection.style.display = 'block';
            }
        }

        // Toggle between grid and table view
        function toggleView(view) {
            currentView = view;
            
            const gridViewBtn = document.getElementById('gridViewBtn');
            const tableViewBtn = document.getElementById('tableViewBtn');
            
            if (view === 'grid') {
                gridViewBtn.classList.add('active');
                tableViewBtn.classList.remove('active');
                
                if (currentTab === 'crypto') {
                    document.getElementById('cryptoContainer').style.display = 'grid';
                    document.getElementById('cryptoTableSection').style.display = 'none';
                } else if (currentTab === 'stocks') {
                    document.getElementById('stocksContainer').style.display = 'grid';
                    document.getElementById('stocksTableSection').style.display = 'none';
                } else if (currentTab === 'russian') {
                    document.getElementById('russianStocksContainer').style.display = 'grid';
                    document.getElementById('russianStocksTableSection').style.display = 'none';
                } else if (currentTab === 'futures') {
                    document.getElementById('futuresContainer').style.display = 'grid';
                    document.getElementById('futuresTableSection').style.display = 'none';
                }
            } else {
                gridViewBtn.classList.remove('active');
                tableViewBtn.classList.add('active');
                
                if (currentTab === 'crypto') {
                    document.getElementById('cryptoContainer').style.display = 'none';
                    document.getElementById('cryptoTableSection').style.display = 'block';
                } else if (currentTab === 'stocks') {
                    document.getElementById('stocksContainer').style.display = 'none';
                    document.getElementById('stocksTableSection').style.display = 'block';
                } else if (currentTab === 'russian') {
                    document.getElementById('russianStocksContainer').style.display = 'none';
                    document.getElementById('russianStocksTableSection').style.display = 'block';
                } else if (currentTab === 'futures') {
                    document.getElementById('futuresContainer').style.display = 'none';
                    document.getElementById('futuresTableSection').style.display = 'block';
                }
            }
        }

        // Update market pulse bar
        function updateMarketPulse(cryptoData, stocksData, russianStocksData, futuresData) {
            const pulseBar = document.getElementById('pulseBar');
            const pulseIndicator = document.getElementById('pulseIndicator');
            const pulseStatus = document.getElementById('pulseStatus');
            
            // Calculate average performance (simulated)
            let cryptoPerformance = 0;
            let stocksPerformance = 0;
            let russianStocksPerformance = 0;
            let futuresPerformance = 0;
            
            if (cryptoData && cryptoData.length > 0) {
                cryptoPerformance = cryptoData.reduce((sum, crypto) => sum + crypto.price_change_percentage_24h, 0) / cryptoData.length;
            }
            
            if (stocksData && stocksData.length > 0) {
                stocksPerformance = stocksData.reduce((sum, stock) => sum + stock.changePercent, 0) / stocksData.length;
            }
            
            if (russianStocksData && russianStocksData.length > 0) {
                russianStocksPerformance = russianStocksData.reduce((sum, stock) => sum + stock.changePercent, 0) / russianStocksData.length;
            }
            
            if (futuresData && futuresData.length > 0) {
                futuresPerformance = futuresData.reduce((sum, future) => sum + future.priceChangePercent, 0) / futuresData.length;
            }
            
            // Combined performance (weighted average)
            const combinedPerformance = (cryptoPerformance + stocksPerformance + russianStocksPerformance + futuresPerformance) / 4;
            
            // Convert to pulse position (0% to 100%)
            // Assuming -10% to +10% range maps to 0% to 100%
            const minPerformance = -10;
            const maxPerformance = 10;
            let pulsePosition = ((combinedPerformance - minPerformance) / (maxPerformance - minPerformance)) * 100;
            
            // Clamp between 0 and 100
            pulsePosition = Math.max(0, Math.min(100, pulsePosition));
            
            // Update pulse bar
            pulseBar.style.width = pulsePosition + '%';
            
            // Update indicator and status
            if (pulsePosition > 60) {
                pulseIndicator.className = 'pulse-indicator';
                pulseStatus.textContent = 'Bullish';
                pulseStatus.className = 'positive';
            } else if (pulsePosition < 40) {
                pulseIndicator.className = 'pulse-indicator bearish';
                pulseStatus.textContent = 'Bearish';
                pulseStatus.className = 'negative';
            } else {
                pulseIndicator.className = 'pulse-indicator';
                pulseStatus.textContent = 'Neutral';
                pulseStatus.className = '';
            }
        }

        // Load all data (crypto, stocks, russian stocks and futures)
        async function loadAllData() {
            await loadCryptoData();
            await loadStocksData();
            await loadRussianStocksData();
            await loadFuturesData();
        }

        // Load cryptocurrency data
        async function loadCryptoData() {
            const container = document.getElementById('cryptoContainer');
            const tableBody = document.getElementById('cryptoTableBody');
            
            container.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <div>Loading cryptocurrency data...</div>
                </div>
            `;
            
            tableBody.innerHTML = `
                <tr>
                    <td colspan="6" style="text-align: center; padding: 40px;">
                        <div class="loading">
                            <div class="spinner"></div>
                            <div>Loading cryptocurrency data...</div>
                        </div>
                    </td>
                </tr>
            `;

            try {
                // Fetch global data
                const globalResponse = await fetch('https://api.coingecko.com/api/v3/global');
                const globalData = await globalResponse.json();
                updateGlobalStats(globalData.data);

                // Fetch cryptocurrency data
                const ids = cryptoIds.join(',');
                const cryptoResponse = await fetch(
                    `https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=${ids}&order=market_cap_desc&per_page=50&page=1&sparkline=false&price_change_percentage=24h`
                );
                const cryptoData = await cryptoResponse.json();

                displayCryptoData(cryptoData);
                displayCryptoTableData(cryptoData);
                
                // Update market pulse with crypto data
                updateMarketPulse(cryptoData, null, null, null);
            } catch (error) {
                console.error('Error fetching crypto data:', error);
                container.innerHTML = `
                    <div class="loading">
                        <div>Error loading crypto data. Please try again later.</div>
                    </div>
                `;
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px;">
                            <div>Error loading crypto data. Please try again later.</div>
                        </td>
                    </tr>
                `;
            }
        }

        // Load stocks data
        async function loadStocksData() {
            const container = document.getElementById('stocksContainer');
            const tableBody = document.getElementById('stocksTableBody');
            
            container.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <div>Loading stocks data...</div>
                </div>
            `;
            
            tableBody.innerHTML = `
                <tr>
                    <td colspan="6" style="text-align: center; padding: 40px;">
                        <div class="loading">
                            <div class="spinner"></div>
                            <div>Loading stocks data...</div>
                        </div>
                    </td>
                </tr>
            `;

            try {
                // Since we can't use a real API key in this example, we'll simulate stock data
                const stocksData = generateStocksData();
                
                displayStocksData(stocksData);
                displayStocksTableData(stocksData);
                
                // Update market pulse with stocks data
                updateMarketPulse(null, stocksData, null, null);
            } catch (error) {
                console.error('Error fetching stocks data:', error);
                container.innerHTML = `
                    <div class="loading">
                        <div>Error loading stocks data. Please try again later.</div>
                    </div>
                `;
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px;">
                            <div>Error loading stocks data. Please try again later.</div>
                        </td>
                    </tr>
                `;
            }
        }

        // Load russian stocks data
        async function loadRussianStocksData() {
            const container = document.getElementById('russianStocksContainer');
            const tableBody = document.getElementById('russianStocksTableBody');
            
            container.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <div>Loading Russian stocks data...</div>
                </div>
            `;
            
            tableBody.innerHTML = `
                <tr>
                    <td colspan="6" style="text-align: center; padding: 40px;">
                        <div class="loading">
                            <div class="spinner"></div>
                            <div>Loading Russian stocks data...</div>
                        </div>
                    </td>
                </tr>
            `;

            try {
                // Generate simulated russian stocks data
                const russianStocksData = generateRussianStocksData();
                
                displayRussianStocksData(russianStocksData);
                displayRussianStocksTableData(russianStocksData);
                
                // Update market pulse with russian stocks data
                updateMarketPulse(null, null, russianStocksData, null);
            } catch (error) {
                console.error('Error fetching Russian stocks data:', error);
                container.innerHTML = `
                    <div class="loading">
                        <div>Error loading Russian stocks data. Please try again later.</div>
                    </div>
                `;
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px;">
                            <div>Error loading Russian stocks data. Please try again later.</div>
                        </td>
                    </tr>
                `;
            }
        }

        // Load futures data
        async function loadFuturesData() {
            const container = document.getElementById('futuresContainer');
            const tableBody = document.getElementById('futuresTableBody');
            
            container.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <div>Loading perpetual futures data...</div>
                </div>
            `;
            
            tableBody.innerHTML = `
                <tr>
                    <td colspan="7" style="text-align: center; padding: 40px;">
                        <div class="loading">
                            <div class="spinner"></div>
                            <div>Loading perpetual futures data...</div>
                        </div>
                    </td>
                </tr>
            `;

            try {
                // Generate simulated futures data
                const futuresData = generateFuturesData();
                
                displayFuturesData(futuresData);
                displayFuturesTableData(futuresData);
                
                // Update market pulse with futures data
                updateMarketPulse(null, null, null, futuresData);
            } catch (error) {
                console.error('Error fetching futures data:', error);
                container.innerHTML = `
                    <div class="loading">
                        <div>Error loading futures data. Please try again later.</div>
                    </div>
                `;
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px;">
                            <div>Error loading futures data. Please try again later.</div>
                        </td>
                    </tr>
                `;
            }
        }

        // Generate simulated stocks data
        function generateStocksData() {
            const stockNames = {
                'AAPL': 'Apple Inc.',
                'MSFT': 'Microsoft Corporation',
                'GOOGL': 'Alphabet Inc.',
                'AMZN': 'Amazon.com Inc.',
                'TSLA': 'Tesla Inc.',
                'META': 'Meta Platforms Inc.',
                'NVDA': 'NVIDIA Corporation',
                'JPM': 'JPMorgan Chase & Co.',
                'JNJ': 'Johnson & Johnson',
                'V': 'Visa Inc.',
                'PG': 'Procter & Gamble Co.',
                'UNH': 'UnitedHealth Group Inc.',
                'HD': 'Home Depot Inc.',
                'DIS': 'Walt Disney Co.',
                'PYPL': 'PayPal Holdings Inc.'
            };
            
            return stockSymbols.map(symbol => {
                const basePrice = Math.random() * 500 + 50;
                const change = (Math.random() - 0.5) * 10;
                const changePercent = (change / basePrice) * 100;
                const marketCap = basePrice * (Math.random() * 1e9 + 1e9);
                
                return {
                    symbol: symbol,
                    name: stockNames[symbol],
                    price: basePrice,
                    change: change,
                    changePercent: changePercent,
                    marketCap: marketCap
                };
            });
        }

        // Generate simulated russian stocks data
        function generateRussianStocksData() {
            const russianStockNames = {
                'GAZP': 'Газпром',
                'SBER': 'Сбербанк',
                'LKOH': 'Лукойл',
                'ROSN': 'Роснефть',
                'NVTK': 'Новатэк',
                'GMKN': 'ГМК Норникель',
                'PLZL': 'Полюс',
                'TATN': 'Татнефть',
                'ALRS': 'АЛРОСА',
                'POLY': 'Полиметалл',
                'MGNT': 'Магнит',
                'AFKS': 'Система',
                'VTBR': 'ВТБ',
                'MTSS': 'МТС',
                'MOEX': 'Московская биржа'
            };
            
            return russianStockSymbols.map(symbol => {
                const basePrice = Math.random() * 5000 + 100;
                const change = (Math.random() - 0.5) * 50;
                const changePercent = (change / basePrice) * 100;
                const marketCap = basePrice * (Math.random() * 1e10 + 1e9);
                
                return {
                    symbol: symbol,
                    name: russianStockNames[symbol],
                    price: basePrice,
                    change: change,
                    changePercent: changePercent,
                    marketCap: marketCap
                };
            });
        }

        // Generate simulated futures data
        function generateFuturesData() {
            return futuresPairs.map(pair => {
                const basePrice = Math.random() * 50000 + 1000;
                const priceChange = (Math.random() - 0.5) * 1000;
                const priceChangePercent = (priceChange / basePrice) * 100;
                const fundingRate = (Math.random() - 0.5) * 0.1; // -5% to +5%
                const openInterest = Math.random() * 1e9 + 1e8;
                const longLiquidations = Math.random() * 10e6;
                const shortLiquidations = Math.random() * 10e6;
                const totalLiquidations = longLiquidations + shortLiquidations;
                const longPercentage = totalLiquidations > 0 ? (longLiquidations / totalLiquidations) * 100 : 50;
                
                return {
                    pair: pair,
                    price: basePrice,
                    priceChange: priceChange,
                    priceChangePercent: priceChangePercent,
                    fundingRate: fundingRate,
                    openInterest: openInterest,
                    longLiquidations: longLiquidations,
                    shortLiquidations: shortLiquidations,
                    longPercentage: longPercentage
                };
            });
        }

        // Update global statistics
        function updateGlobalStats(data) {
            document.getElementById('totalMarketCap').textContent = formatCurrency(data.total_market_cap.usd);
            document.getElementById('totalVolume').textContent = formatCurrency(data.total_volume.usd);
            document.getElementById('btcDominance').textContent = formatPercentage(data.market_cap_percentage.btc);
            document.getElementById('activeCurrencies').textContent = data.active_cryptocurrencies.toLocaleString();
            
            // Calculate market cap change (simplified)
            const marketCapChange = data.market_cap_change_percentage_24h_usd;
            const marketCapChangeElement = document.getElementById('marketCapChange');
            marketCapChangeElement.textContent = formatPercentage(marketCapChange);
            marketCapChangeElement.className = marketCapChange >= 0 ? 'positive' : 'negative';
        }

        // Display cryptocurrency data in grid
        function displayCryptoData(data) {
            const container = document.getElementById('cryptoContainer');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();

            const filteredData = data.filter(crypto => 
                crypto.name.toLowerCase().includes(searchTerm) ||
                crypto.symbol.toLowerCase().includes(searchTerm)
            );

            if (filteredData.length === 0) {
                container.innerHTML = `
                    <div class="loading">
                        <div>No cryptocurrencies found matching your search.</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredData.map(crypto => `
                <div class="crypto-card" onclick="alert('${crypto.name} (${crypto.symbol.toUpperCase()}) - Current Price: ${formatCurrency(crypto.current_price)}')">
                    <div class="crypto-header">
                        <div class="crypto-name">
                            <div>
                                <div style="font-weight: bold;">${crypto.name}</div>
                                <div class="crypto-symbol">${crypto.symbol.toUpperCase()}</div>
                            </div>
                        </div>
                        <img src="${crypto.image}" alt="${crypto.name}" width="32" height="32" style="border-radius: 50%;">
                    </div>
                    <div class="crypto-price">${formatCurrency(crypto.current_price)}</div>
                    <div class="crypto-change ${crypto.price_change_percentage_24h >= 0 ? 'positive' : 'negative'}">
                        ${crypto.price_change_percentage_24h >= 0 ? '↗' : '↘'} ${formatPercentage(crypto.price_change_percentage_24h)}
                    </div>
                    <div class="crypto-details">
                        <div class="detail-item">
                            <div class="detail-label">Market Cap</div>
                            <div class="detail-value">${formatNumber(crypto.market_cap)}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">24h Volume</div>
                            <div class="detail-value">${formatNumber(crypto.total_volume)}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Display cryptocurrency data in table
        function displayCryptoTableData(data) {
            const tableBody = document.getElementById('cryptoTableBody');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();

            const filteredData = data.filter(crypto => 
                crypto.name.toLowerCase().includes(searchTerm) ||
                crypto.symbol.toLowerCase().includes(searchTerm)
            );

            if (filteredData.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px;">
                            <div>No cryptocurrencies found matching your search.</div>
                        </td>
                    </tr>
                `;
                return;
            }

            tableBody.innerHTML = filteredData.map((crypto, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>
                        <div class="table-crypto">
                            <img src="${crypto.image}" alt="${crypto.name}">
                            <div>
                                <div class="table-crypto-name">${crypto.name}</div>
                                <div class="table-crypto-symbol">${crypto.symbol.toUpperCase()}</div>
                            </div>
                        </div>
                    </td>
                    <td class="table-price">${formatCurrency(crypto.current_price)}</td>
                    <td>
                        <div class="table-change ${crypto.price_change_percentage_24h >= 0 ? 'positive' : 'negative'}">
                            ${crypto.price_change_percentage_24h >= 0 ? '↗' : '↘'} ${formatPercentage(crypto.price_change_percentage_24h)}
                        </div>
                    </td>
                    <td class="table-market-cap">${formatNumber(crypto.market_cap)}</td>
                    <td class="table-volume">${formatNumber(crypto.total_volume)}</td>
                </tr>
            `).join('');
        }

        // Display stocks data in grid
        function displayStocksData(data) {
            const container = document.getElementById('stocksContainer');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();

            const filteredData = data.filter(stock => 
                stock.name.toLowerCase().includes(searchTerm) ||
                stock.symbol.toLowerCase().includes(searchTerm)
            );

            if (filteredData.length === 0) {
                container.innerHTML = `
                    <div class="loading">
                        <div>No stocks found matching your search.</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredData.map(stock => `
                <div class="stock-card" onclick="alert('${stock.name} (${stock.symbol}) - Current Price: ${formatCurrency(stock.price)}')">
                    <div class="stock-header">
                        <div class="stock-name">
                            <div>
                                <div style="font-weight: bold;">${stock.name}</div>
                                <div class="stock-symbol">${stock.symbol}</div>
                            </div>
                        </div>
                        <div style="width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(45deg, #00ff88, #00ccff); display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 12px;">
                            ${stock.symbol.charAt(0)}
                        </div>
                    </div>
                    <div class="stock-price">${formatCurrency(stock.price)}</div>
                    <div class="stock-change ${stock.change >= 0 ? 'positive' : 'negative'}">
                        ${stock.change >= 0 ? '↗' : '↘'} ${formatCurrency(Math.abs(stock.change))} (${formatPercentage(stock.changePercent)})
                    </div>
                    <div class="stock-details">
                        <div class="detail-item">
                            <div class="detail-label">Market Cap</div>
                            <div class="detail-value">${formatNumber(stock.marketCap)}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Daily Change</div>
                            <div class="detail-value ${stock.change >= 0 ? 'positive' : 'negative'}">${formatPercentage(stock.changePercent)}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Display stocks data in table
        function displayStocksTableData(data) {
            const tableBody = document.getElementById('stocksTableBody');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();

            const filteredData = data.filter(stock => 
                stock.name.toLowerCase().includes(searchTerm) ||
                stock.symbol.toLowerCase().includes(searchTerm)
            );

            if (filteredData.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px;">
                            <div>No stocks found matching your search.</div>
                        </td>
                    </tr>
                `;
                return;
            }

            tableBody.innerHTML = filteredData.map((stock, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>
                        <div class="table-stock">
                            <div style="width: 24px; height: 24px; border-radius: 50%; background: linear-gradient(45deg, #00ff88, #00ccff); display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 10px;">
                                ${stock.symbol.charAt(0)}
                            </div>
                            <div>
                                <div class="table-stock-name">${stock.name}</div>
                                <div class="table-stock-symbol">${stock.symbol}</div>
                            </div>
                        </div>
                    </td>
                    <td class="table-price">${formatCurrency(stock.price)}</td>
                    <td class="${stock.change >= 0 ? 'positive' : 'negative'}">${formatCurrency(stock.change)}</td>
                    <td>
                        <div class="table-change ${stock.change >= 0 ? 'positive' : 'negative'}">
                            ${stock.change >= 0 ? '↗' : '↘'} ${formatPercentage(stock.changePercent)}
                        </div>
                    </td>
                    <td class="table-market-cap">${formatNumber(stock.marketCap)}</td>
                </tr>
            `).join('');
        }

        // Display russian stocks data in grid
        function displayRussianStocksData(data) {
            const container = document.getElementById('russianStocksContainer');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();

            const filteredData = data.filter(stock => 
                stock.name.toLowerCase().includes(searchTerm) ||
                stock.symbol.toLowerCase().includes(searchTerm)
            );

            if (filteredData.length === 0) {
                container.innerHTML = `
                    <div class="loading">
                        <div>No Russian stocks found matching your search.</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredData.map(stock => `
                <div class="stock-card russian-stock" onclick="alert('${stock.name} (${stock.symbol}) - Current Price: ${formatCurrency(stock.price, 'RUB')}')">
                    <div class="stock-header">
                        <div class="stock-name">
                            <div>
                                <div style="font-weight: bold;">${stock.name}</div>
                                <div class="stock-symbol">${stock.symbol}</div>
                            </div>
                        </div>
                        <div style="width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(45deg, #0055ff, #ffffff, #ff0000); display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 12px;">
                            ${stock.symbol.charAt(0)}
                        </div>
                    </div>
                    <div class="stock-price">${formatCurrency(stock.price, 'RUB')}</div>
                    <div class="stock-change ${stock.change >= 0 ? 'positive' : 'negative'}">
                        ${stock.change >= 0 ? '↗' : '↘'} ${formatCurrency(Math.abs(stock.change), 'RUB')} (${formatPercentage(stock.changePercent)})
                    </div>
                    <div class="stock-details">
                        <div class="detail-item">
                            <div class="detail-label">Market Cap</div>
                            <div class="detail-value">${formatNumber(stock.marketCap)}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Daily Change</div>
                            <div class="detail-value ${stock.change >= 0 ? 'positive' : 'negative'}">${formatPercentage(stock.changePercent)}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Display russian stocks data in table
        function displayRussianStocksTableData(data) {
            const tableBody = document.getElementById('russianStocksTableBody');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();

            const filteredData = data.filter(stock => 
                stock.name.toLowerCase().includes(searchTerm) ||
                stock.symbol.toLowerCase().includes(searchTerm)
            );

            if (filteredData.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px;">
                            <div>No Russian stocks found matching your search.</div>
                        </td>
                    </tr>
                `;
                return;
            }

            tableBody.innerHTML = filteredData.map((stock, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>
                        <div class="table-stock">
                            <div style="width: 24px; height: 24px; border-radius: 50%; background: linear-gradient(45deg, #0055ff, #ffffff, #ff0000); display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 10px;">
                                ${stock.symbol.charAt(0)}
                            </div>
                            <div>
                                <div class="table-stock-name">${stock.name}</div>
                                <div class="table-stock-symbol">${stock.symbol}</div>
                            </div>
                        </div>
                    </td>
                    <td class="table-price">${formatCurrency(stock.price, 'RUB')}</td>
                    <td class="${stock.change >= 0 ? 'positive' : 'negative'}">${formatCurrency(stock.change, 'RUB')}</td>
                    <td>
                        <div class="table-change ${stock.change >= 0 ? 'positive' : 'negative'}">
                            ${stock.change >= 0 ? '↗' : '↘'} ${formatPercentage(stock.changePercent)}
                        </div>
                    </td>
                    <td class="table-market-cap">${formatNumber(stock.marketCap)}</td>
                </tr>
            `).join('');
        }

        // Display futures data in grid
        function displayFuturesData(data) {
            const container = document.getElementById('futuresContainer');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();

            const filteredData = data.filter(future => 
                future.pair.toLowerCase().includes(searchTerm)
            );

            if (filteredData.length === 0) {
                container.innerHTML = `
                    <div class="loading">
                        <div>No futures found matching your search.</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredData.map(future => `
                <div class="futures-card" onclick="alert('${future.pair} Perpetual - Price: ${formatCurrency(future.price)}')">
                    <div class="futures-header">
                        <div class="futures-name">
                            <div>
                                <div style="font-weight: bold;">${future.pair}</div>
                                <div class="futures-symbol">PERPETUAL</div>
                            </div>
                        </div>
                        <div style="width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(45deg, #ffaa00, #ff4444); display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 12px;">
                            F
                        </div>
                    </div>
                    <div class="futures-price">${formatCurrency(future.price)}</div>
                    <div class="futures-change ${future.priceChangePercent >= 0 ? 'positive' : 'negative'}">
                        ${future.priceChangePercent >= 0 ? '↗' : '↘'} ${formatPercentage(future.priceChangePercent)}
                    </div>
                    <div class="futures-details">
                        <div class="detail-item">
                            <div class="detail-label">Funding Rate</div>
                            <div class="detail-value funding-rate ${future.fundingRate > 0 ? 'positive' : future.fundingRate < 0 ? 'negative' : 'neutral'}">
                                ${formatFundingRate(future.fundingRate)}
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Open Interest</div>
                            <div class="detail-value">${formatNumber(future.openInterest)}</div>
                        </div>
                    </div>
                    <div style="margin-top: 10px;">
                        <div class="detail-label">Liquidation Ratio</div>
                        <div class="liquidation-bar">
                            <div class="liquidation-long" style="width: ${future.longPercentage}%"></div>
                            <div class="liquidation-short" style="width: ${100 - future.longPercentage}%"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 0.75em; margin-top: 5px;">
                            <span class="positive">Long: ${formatNumber(future.longLiquidations)}</span>
                            <span class="negative">Short: ${formatNumber(future.shortLiquidations)}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Display futures data in table
        function displayFuturesTableData(data) {
            const tableBody = document.getElementById('futuresTableBody');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();

            const filteredData = data.filter(future => 
                future.pair.toLowerCase().includes(searchTerm)
            );

            if (filteredData.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px;">
                            <div>No futures found matching your search.</div>
                        </td>
                    </tr>
                `;
                return;
            }

            tableBody.innerHTML = filteredData.map((future, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>
                        <div class="table-futures">
                            <div style="width: 24px; height: 24px; border-radius: 50%; background: linear-gradient(45deg, #ffaa00, #ff4444); display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 10px;">
                                F
                            </div>
                            <div>
                                <div class="table-futures-name">${future.pair}</div>
                                <div class="table-futures-symbol">PERPETUAL</div>
                            </div>
                        </div>
                    </td>
                    <td class="table-price">${formatCurrency(future.price)}</td>
                    <td>
                        <div class="table-change ${future.priceChangePercent >= 0 ? 'positive' : 'negative'}">
                            ${future.priceChangePercent >= 0 ? '↗' : '↘'} ${formatPercentage(future.priceChangePercent)}
                        </div>
                    </td>
                    <td>
                        <div class="funding-rate ${future.fundingRate > 0 ? 'positive' : future.fundingRate < 0 ? 'negative' : 'neutral'}">
                            ${formatFundingRate(future.fundingRate)}
                        </div>
                    </td>
                    <td class="open-interest">${formatNumber(future.openInterest)}</td>
                    <td>
                        <div class="liquidation-bar">
                            <div class="liquidation-long" style="width: ${future.longPercentage}%"></div>
                            <div class="liquidation-short" style="width: ${100 - future.longPercentage}%"></div>
                        </div>
                        <div style="font-size: 0.75em; margin-top: 5px;">
                            <span class="positive">${Math.round(future.longPercentage)}%</span> / 
                            <span class="negative">${Math.round(100 - future.longPercentage)}%</span>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Search functionality
        document.getElementById('searchInput').addEventListener('input', function() {
            if (currentTab === 'crypto') {
                if (currentView === 'grid') {
                    loadCryptoData();
                } else {
                    // For table view, we need to refilter the data
                    const searchTerm = this.value.toLowerCase();
                    const rows = document.querySelectorAll('#cryptoTableBody tr');
                    
                    rows.forEach(row => {
                        const name = row.querySelector('.table-crypto-name').textContent.toLowerCase();
                        const symbol = row.querySelector('.table-crypto-symbol').textContent.toLowerCase();
                        
                        if (name.includes(searchTerm) || symbol.includes(searchTerm)) {
                            row.style.display = '';
                        } else {
                            row.style.display = 'none';
                        }
                    });
                }
            } else if (currentTab === 'stocks') {
                if (currentView === 'grid') {
                    loadStocksData();
                } else {
                    // For table view, we need to refilter the data
                    const searchTerm = this.value.toLowerCase();
                    const rows = document.querySelectorAll('#stocksTableBody tr');
                    
                    rows.forEach(row => {
                        const name = row.querySelector('.table-stock-name').textContent.toLowerCase();
                        const symbol = row.querySelector('.table-stock-symbol').textContent.toLowerCase();
                        
                        if (name.includes(searchTerm) || symbol.includes(searchTerm)) {
                            row.style.display = '';
                        } else {
                            row.style.display = 'none';
                        }
                    });
                }
            } else if (currentTab === 'russian') {
                if (currentView === 'grid') {
                    loadRussianStocksData();
                } else {
                    // For table view, we need to refilter the data
                    const searchTerm = this.value.toLowerCase();
                    const rows = document.querySelectorAll('#russianStocksTableBody tr');
                    
                    rows.forEach(row => {
                        const name = row.querySelector('.table-stock-name').textContent.toLowerCase();
                        const symbol = row.querySelector('.table-stock-symbol').textContent.toLowerCase();
                        
                        if (name.includes(searchTerm) || symbol.includes(searchTerm)) {
                            row.style.display = '';
                        } else {
                            row.style.display = 'none';
                        }
                    });
                }
            } else if (currentTab === 'futures') {
                if (currentView === 'grid') {
                    loadFuturesData();
                } else {
                    // For table view, we need to refilter the data
                    const searchTerm = this.value.toLowerCase();
                    const rows = document.querySelectorAll('#futuresTableBody tr');
                    
                    rows.forEach(row => {
                        const name = row.querySelector('.table-futures-name').textContent.toLowerCase();
                        const symbol = row.querySelector('.table-futures-symbol').textContent.toLowerCase();
                        
                        if (name.includes(searchTerm) || symbol.includes(searchTerm)) {
                            row.style.display = '';
                        } else {
                            row.style.display = 'none';
                        }
                    });
                }
            }
        });

        // Auto-refresh every 60 seconds
        setInterval(loadAllData, 60000);

        // Initial load
        loadAllData();
    </script>
</body>
</html>