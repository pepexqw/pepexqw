<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–æ–ª–æ—Å–æ–≤–æ–π –∏ –≤–∏–¥–µ–æ —á–∞—Ç</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 1200px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 90vh;
        }
        
        .header {
            background-color: #4a6cfa;
            color: white;
            padding: 20px;
            text-align: center;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #2c3e50;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        .participants {
            width: 250px;
            background-color: #f8f9fa;
            padding: 15px;
            border-right: 1px solid #e9ecef;
            overflow-y: auto;
        }
        
        .participants h3 {
            margin-bottom: 15px;
            color: #495057;
            padding-bottom: 10px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .user-list {
            list-style-type: none;
        }
        
        .user-list li {
            padding: 10px;
            margin-bottom: 10px;
            background-color: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .user-list .avatar {
            width: 30px;
            height: 30px;
            font-size: 14px;
        }
        
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            background-color: #edf2f7;
        }
        
        .video-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            flex: 1;
            overflow-y: auto;
            margin-bottom: 15px;
        }
        
        .video-item {
            background-color: #2d3748;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .video-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .video-label {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background-color: rgba(0, 0, 0, 0.6);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            padding: 15px;
            background-color: white;
            border-top: 1px solid #e9ecef;
        }
        
        .control-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .mic-btn {
            background-color: #4a6cfa;
            color: white;
        }
        
        .mic-btn.muted {
            background-color: #ff4757;
        }
        
        .camera-btn {
            background-color: #4a6cfa;
            color: white;
        }
        
        .camera-btn.disabled {
            background-color: #ff4757;
        }
        
        .screen-share-btn {
            background-color: #4a6cfa;
            color: white;
        }
        
        .screen-share-btn.active {
            background-color: #2ed573;
        }
        
        .leave-btn {
            background-color: #ff4757;
            color: white;
        }
        
        .login-screen {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 500px;
            padding: 30px;
            text-align: center;
        }
        
        .login-screen h1 {
            margin-bottom: 20px;
            color: #2d3748;
        }
        
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2d3748;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .btn {
            padding: 12px 20px;
            background-color: #4a6cfa;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background-color 0.3s;
            width: 100%;
        }
        
        .btn:hover {
            background-color: #3a5bd9;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background-color: #2ed573;
            color: white;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transform: translateX(150%);
            transition: transform 0.3s;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div id="login-screen" class="login-screen">
        <h1>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –≥–æ–ª–æ—Å–æ–≤–æ–º—É —á–∞—Ç—É</h1>
        <div class="form-group">
            <label for="username">–í–∞—à–µ –∏–º—è</label>
            <input type="text" id="username" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è">
        </div>
        <div class="form-group">
            <label for="room-id">ID –∫–æ–º–Ω–∞—Ç—ã</label>
            <input type="text" id="room-id" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ ID –∫–æ–º–Ω–∞—Ç—ã">
        </div>
        <button id="join-btn" class="btn">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
    </div>

    <div id="app-container" class="container hidden">
        <div class="header">
            <h1>–ì–æ–ª–æ—Å–æ–≤–æ–π –∏ –≤–∏–¥–µ–æ —á–∞—Ç</h1>
            <div class="user-info">
                <div class="avatar" id="user-avatar">U</div>
                <span id="user-name">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>
            </div>
        </div>
        
        <div class="main-content">
            <div class="participants">
                <h3>–£—á–∞—Å—Ç–Ω–∏–∫–∏</h3>
                <ul id="users-list" class="user-list">
                    <li>–ó–∞–≥—Ä—É–∑–∫–∞...</li>
                </ul>
            </div>
            
            <div class="chat-area">
                <div id="video-container" class="video-container">
                    <!-- –í–∏–¥–µ–æ —ç–ª–µ–º–µ–Ω—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –∑–¥–µ—Å—å -->
                </div>
                
                <div class="controls">
                    <button id="mic-btn" class="control-btn mic-btn" title="–ú–∏–∫—Ä–æ—Ñ–æ–Ω">
                        <i>üé§</i>
                    </button>
                    <button id="camera-btn" class="control-btn camera-btn" title="–ö–∞–º–µ—Ä–∞">
                        <i>üìπ</i>
                    </button>
                    <button id="screen-share-btn" class="control-btn screen-share-btn" title="–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —ç–∫—Ä–∞–Ω–∞">
                        <i>üñ•Ô∏è</i>
                    </button>
                    <button id="leave-btn" class="control-btn leave-btn" title="–ü–æ–∫–∏–Ω—É—Ç—å —á–∞—Ç">
                        <i>üìû</i>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="notification" class="notification"></div>

    <script>
        // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        const loginScreen = document.getElementById('login-screen');
        const appContainer = document.getElementById('app-container');
        const usernameInput = document.getElementById('username');
        const roomIdInput = document.getElementById('room-id');
        const joinBtn = document.getElementById('join-btn');
        const userAvatar = document.getElementById('user-avatar');
        const userName = document.getElementById('user-name');
        const usersList = document.getElementById('users-list');
        const videoContainer = document.getElementById('video-container');
        const micBtn = document.getElementById('mic-btn');
        const cameraBtn = document.getElementById('camera-btn');
        const screenShareBtn = document.getElementById('screen-share-btn');
        const leaveBtn = document.getElementById('leave-btn');
        const notification = document.getElementById('notification');
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        let localStream = null;
        let screenStream = null;
        let isMicMuted = false;
        let isCameraOff = false;
        let isScreenSharing = false;
        let currentUser = null;
        let roomId = null;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function init() {
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–π ID –∫–æ–º–Ω–∞—Ç—ã, –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω
            roomIdInput.value = generateRoomId();
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            joinBtn.addEventListener('click', joinRoom);
            micBtn.addEventListener('click', toggleMicrophone);
            cameraBtn.addEventListener('click', toggleCamera);
            screenShareBtn.addEventListener('click', toggleScreenShare);
            leaveBtn.addEventListener('click', leaveRoom);
            
            // –ó–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ –∏ –∫–∞–º–µ—Ä—ã
            requestMediaPermissions();
        }
        
        // –ó–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –Ω–∞ –º–µ–¥–∏–∞
        async function requestMediaPermissions() {
            try {
                // –ü—Ä–æ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –º–µ–¥–∏–∞—É—Å—Ç—Ä–æ–π—Å—Ç–≤
                const devices = await navigator.mediaDevices.enumerateDevices();
                console.log("–î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ–¥–∏–∞—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:", devices);
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–µ–¥–∏–∞—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º:", error);
            }
        }
        
        // –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –∫–æ–º–Ω–∞—Ç–µ
        async function joinRoom() {
            const name = usernameInput.value.trim();
            roomId = roomIdInput.value.trim();
            
            if (!name) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
                return;
            }
            
            if (!roomId) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ ID –∫–æ–º–Ω–∞—Ç—ã');
                return;
            }
            
            currentUser = {
                id: generateUserId(),
                name: name
            };
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            userAvatar.textContent = name.charAt(0).toUpperCase();
            userName.textContent = name;
            
            // –ü–æ–ª—É—á–∞–µ–º –º–µ–¥–∏–∞–ø–æ—Ç–æ–∫
            try {
                localStream = await navigator.mediaDevices.getUserMedia({
                    video: true,
                    audio: true
                });
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤–∏–¥–µ–æ
                addVideoStream(currentUser.id, localStream, name, true);
                
                // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —á–∞—Ç–∞
                loginScreen.classList.add('hidden');
                appContainer.classList.remove('hidden');
                
                // –°–∏–º—É–ª—è—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                simulateOtherUsers();
                
                showNotification(`–í—ã –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å –∫ –∫–æ–º–Ω–∞—Ç–µ ${roomId}`);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–µ–¥–∏–∞—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º:', error);
                showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ/–º–∏–∫—Ä–æ—Ñ–æ–Ω—É');
            }
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–µ–æ –ø–æ—Ç–æ–∫–∞
        function addVideoStream(userId, stream, name, isLocal = false) {
            // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –≤–∏–¥–µ–æ —ç–ª–µ–º–µ–Ω—Ç, –µ—Å–ª–∏ –µ—Å—Ç—å
            const existingVideo = document.getElementById(`video-${userId}`);
            if (existingVideo) {
                existingVideo.remove();
            }
            
            const videoElement = document.createElement('div');
            videoElement.classList.add('video-item');
            videoElement.id = `video-${userId}`;
            
            const video = document.createElement('video');
            video.srcObject = stream;
            video.autoplay = true;
            video.playsInline = true;
            video.muted = isLocal;
            
            const label = document.createElement('div');
            label.classList.add('video-label');
            label.textContent = isLocal ? `${name} (–í—ã)` : name;
            
            videoElement.appendChild(video);
            videoElement.appendChild(label);
            videoContainer.appendChild(videoElement);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–ø–∏—Å–æ–∫
            updateUsersList(userId, name);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function updateUsersList(userId, name) {
            // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∑–∞–ø–∏—Å—å, –µ—Å–ª–∏ –µ—Å—Ç—å
            const existingUser = document.getElementById(`user-${userId}`);
            if (existingUser) {
                existingUser.remove();
            }
            
            const userItem = document.createElement('li');
            userItem.id = `user-${userId}`;
            
            const avatar = document.createElement('div');
            avatar.classList.add('avatar');
            avatar.textContent = name.charAt(0).toUpperCase();
            
            const userName = document.createElement('span');
            userName.textContent = name;
            
            userItem.appendChild(avatar);
            userItem.appendChild(userName);
            usersList.appendChild(userItem);
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
        function toggleMicrophone() {
            if (!localStream) return;
            
            const audioTracks = localStream.getAudioTracks();
            if (audioTracks.length === 0) return;
            
            isMicMuted = !isMicMuted;
            audioTracks[0].enabled = !isMicMuted;
            
            micBtn.classList.toggle('muted', isMicMuted);
            showNotification(isMicMuted ? '–ú–∏–∫—Ä–æ—Ñ–æ–Ω –æ—Ç–∫–ª—é—á–µ–Ω' : '–ú–∏–∫—Ä–æ—Ñ–æ–Ω –≤–∫–ª—é—á–µ–Ω');
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã
        function toggleCamera() {
            if (!localStream) return;
            
            const videoTracks = localStream.getVideoTracks();
            if (videoTracks.length === 0) return;
            
            isCameraOff = !isCameraOff;
            videoTracks[0].enabled = !isCameraOff;
            
            cameraBtn.classList.toggle('disabled', isCameraOff);
            showNotification(isCameraOff ? '–ö–∞–º–µ—Ä–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞' : '–ö–∞–º–µ—Ä–∞ –≤–∫–ª—é—á–µ–Ω–∞');
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —ç–∫—Ä–∞–Ω–∞
        async function toggleScreenShare() {
            try {
                if (!isScreenSharing) {
                    // –ó–∞–ø—É—Å–∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —ç–∫—Ä–∞–Ω–∞
                    screenStream = await navigator.mediaDevices.getDisplayMedia({
                        video: true,
                        audio: true
                    });
                    
                    // –ó–∞–º–µ–Ω—è–µ–º –≤–∏–¥–µ–æ—Ç—Ä–∞–∫ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
                    const videoTrack = screenStream.getVideoTracks()[0];
                    const localVideoTrack = localStream.getVideoTracks()[0];
                    localStream.removeTrack(localVideoTrack);
                    localStream.addTrack(videoTrack);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–¥–µ–æ —ç–ª–µ–º–µ–Ω—Ç
                    addVideoStream(currentUser.id, localStream, currentUser.name, true);
                    
                    isScreenSharing = true;
                    screenShareBtn.classList.add('active');
                    
                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —ç–∫—Ä–∞–Ω–∞
                    videoTrack.onended = () => {
                        toggleScreenShare();
                    };
                    
                    showNotification('–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —ç–∫—Ä–∞–Ω–∞ –Ω–∞—á–∞—Ç–∞');
                } else {
                    // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —ç–∫—Ä–∞–Ω–∞
                    const videoTrack = localStream.getVideoTracks()[0];
                    localStream.removeTrack(videoTrack);
                    
                    // –ü–æ–ª—É—á–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ –∫–∞–º–µ—Ä—É
                    const cameraStream = await navigator.mediaDevices.getUserMedia({
                        video: true,
                        audio: false
                    });
                    
                    const cameraTrack = cameraStream.getVideoTracks()[0];
                    localStream.addTrack(cameraTrack);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–¥–µ–æ —ç–ª–µ–º–µ–Ω—Ç
                    addVideoStream(currentUser.id, localStream, currentUser.name, true);
                    
                    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º screenStream
                    screenStream.getTracks().forEach(track => track.stop());
                    screenStream = null;
                    
                    isScreenSharing = false
